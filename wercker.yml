# This references the default golang container from
# the Docker Hub: https://registry.hub.docker.com/u/library/golang/
# If you want Google's container you would reference google/golang
# Read more about containers on our dev center
# http://devcenter.wercker.com/docs/containers/index.html
box: golang
    # - postgres
    # http://devcenter.wercker.com/docs/services/postgresql.html

    # - mongo
    # http://devcenter.wercker.com/docs/services/mongodb.html
build:
  # The steps that will be executed on build
  # Steps make up the actions in your pipeline
  # Read more about steps on our dev center:
  # http://devcenter.wercker.com/docs/steps/index.html
  steps:
    - setup-go-workspace:
        package-dir: github.com/shihchang/hello
    # Build the project
    - script:
        name: go build
        code: |
          ls
          go build
          pwd
          ls
    - script:
        name: ls it
        code: |
          pwd
          ls
# http://devcenter.wercker.com/docs/creating-a-workflow-0-0
deploy:
  steps:
    - script:
      name: deploy step one
      code: echo "Deploy Step 1"
    - script:
      name: deploy step two
      code: echo "Deploy Step 2"
    - script:
      name: deploy step three
      code: echo "Deploy Step 3"
    - script:
      name: deploy step four
      code: echo "Deploy Step 4"
    - script:
      name: deploy step five
      code: echo "Deploy Step 5"

test:
    steps:
        - script:
            name: test 1
            code: pwd
        - script:
            name: test 2
            code: ls
        - script:
            name: test 3
            code: ./hello

push-image:
  box:
    id: alpine
    cmd: /bin/sh

  steps:
    - internal/docker-scratch-push:
        repository: wcr.io/wercker/hello
        tag: $WERCKER_GIT_BRANCH-$WERCKER_GIT_COMMIT
        registry: https://wcr.io/v2
        username: $WCR_USERNAME
        password: $WCR_PASSWORD
        cmd: ./hello
